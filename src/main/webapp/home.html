<!DOCTYPE html>
<html ng-app="marcus" lang="no">
    <head>
        <meta charset="utf-8"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
        <base href="blackbox">
        <title>Blackbox</title>
        <meta name="description" content="Search Marcus data" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="shortcut icon" type="image/x-icon" href="http://marcus.uib.no/img/favicon.ico"/>
        <link rel="stylesheet" href="js/lib/typeahead/css/main.css"/>
        <link rel="stylesheet" href="js/lib/typeahead/css/normalize.min.css"/>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"/>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css"/>
        <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css"/>
        <link href="http://fonts.googleapis.com/css?family=IM+Fell+Great+Primer" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.1.8/semantic.min.css" />
        <link rel="stylesheet" href="css/marcus.css" />
    </head>
    <body>
    <!-- Sticky header-->
        <div class="ui fixed inverted menu hidden-sm hidden-xs">
            <div class="top-header ui container fluid header-wrap">
                <a id="show-menu" class="item">
                    <i class="sidebar icon"></i>
                </a>
                <div class="header brand item">
                    <a href="#">MARCUS ADMIN</a>
                </div>
            </div>
        </div>
        <!-- Controller starts here-->
        <div ng-controller="freeTextSearch" id="searchController">
            <div class="main-container">
                <div class="masthead">
                        <form action="" method="GET">
                            <!--input type="hidden" name="index" value="admin"-->
                            <div class="Typeahead">
                                <div class="u-posRelative">
                                    <input class="Typeahead-hint" type="text" tabindex="-1" readonly="readonly"/>
                                    <input class="Typeahead-input" 
                                           id="search-input" 
                                           type="text" 
                                           name="q" 
                                           ng-model="queryString"
                                           ng-keyup="($event.keyCode==13 || queryString==='')&&search()"
                                           placeholder="Søk Marcus ..."
                                           autocomplete="off"/>
                                    <!--img class="Typeahead-spinner" src="js/lib/typeahead/img/spinner.gif" alt=""/-->
                                    <button class="Typeahead-search-icon" type="button" ng-click="search()">
                                        <i class="search icon"></i>
                                    </button>
                                </div>
                                <div class="Typeahead-menu"></div>
                            </div>
                        </form>
                    <!--span style="color:grey;"> Trykk på Enter for å søke</span-->
                    <!--span class="links links-examples">
                        <a href="">Advasert søk</a>
                    </span-->
                </div>
            </div>
                <img class="blackbox-loading" src="img/loading.gif" alt="Loading ...">
                <!---uib-progressbar ng-show="show_loading" class="ui loading segment"  value="dynamic" style="height:100px;"></uib-progressbar-->
                <div ng-cloak ng-show="ready" style="margin-top:30px;" class="ui container">
                    <div class="search-results ui grid">
                        <div class="content ui row">
                            <!--Starting with facets-->
                            <div ng-cloak class="ng-cloak facets ui four wide column computer only">
                                <h3 style="margin-top:15px;">Skapt</h3>
                                <hr>
                                <div class="datePicker ui input">
                                     <input type="text" id="from_date" class="datePicker" ng-model="fromDate" ng-change="search()" placeholder="FRA" title="Fra dato">
                               </div><br/><br/>
                                <div class="datePicker ui input">
                                     <input type="text" id="to_date" class="datePicker" ng-model="toDate" ng-change="search()" placeholder="TIL" title="Til dato">
                                </div><br/><br/>
                                <!-- Document types facets-->
                                <h3>Dokument typer</h3>
                                <hr>
                                <div class="ui list">  <!--style="height:500px; overflow-y: scroll"-->
                                    <div class="ui checkbox item" ng-repeat="bucket in results['aggregations']['type.exact']['buckets']">
                                        <input id="type-{{bucket.key}}" type="checkbox" checklist-model="selectedFilters" checklist-value="getCheckedValue('type.exact', bucket.key)" ng-click="search()">
                                        <label for="type-{{bucket.key}}" ng-class="{'disabled': bucket.doc_count == 0}"> {{bucket.key}}
                                            <span ng-if="bucket.doc_count > 0" style="color:grey"> ({{bucket.doc_count | number}})</span>
                                        </label>
                                    </div>
                                </div>
                                <!-- Category facets -->
                                <h3>Kategorier</h3>
                                <hr>
                                <div class="ui relaxed list">
                                    <div class="ui item checkbox" ng-repeat="bucket in results['aggregations']['hasZoom']['buckets']">
                                        <input id="hasZoom-{{bucket.key}}" type="checkbox" checklist-model="selectedFilters" checklist-value="getCheckedValue('hasZoom', bucket.key)" ng-click="search()">
                                        <label for="hasZoom-{{bucket.key}}"> {{bucket.key}} <span style="color:grey"> ({{bucket.doc_count | number}})</span></label>
                                    </div>
                                    <div class="ui item checkbox" ng-repeat="bucket in results['aggregations']['isDigitized']['buckets']">
                                        <input id="isDigitized-{{bucket.key}}" type="checkbox" checklist-model="selectedFilters" checklist-value="getCheckedValue('isDigitized', bucket.key)" ng-click="search()">
                                        <label for="isDigitized-{{bucket.key}}">{{bucket.key}} <span style="color:grey"> ({{bucket.doc_count | number}})</span></label>
                                    </div>
                                    <div class="ui item checkbox" ng-repeat="bucket in results['aggregations']['isCatalogued']['buckets']">
                                        <input id="isCatalogued-{{bucket.key}}" type="checkbox" checklist-model="selectedFilters" checklist-value="getCheckedValue('isCatalogued', bucket.key)" ng-click="search()">
                                        <label for="isCatalogued-{{bucket.key}}">{{bucket.key}} <span style="color:grey"> ({{bucket.doc_count | number}})</span></label>
                                    </div>
                                </div>
                                <!-- Topic facets-->
                                <h3>Emne</h3>
                                <hr>
                                <div class="ui list" style="height:500px; overflow-y: scroll" >
                                    <div class="ui checkbox item" ng-repeat="bucket in results['aggregations']['subject.exact']['buckets']">
                                        <input id="subject-{{bucket.key}}" type="checkbox" checklist-model="selectedFilters" checklist-value="getCheckedValue('subject.exact', bucket.key)" ng-click="search()">
                                        <label for="subject-{{bucket.key}}" class="row-fluid"> {{bucket.key}}
                                              <span style="color:gray">({{bucket.doc_count | number}})</span>
                                        </label>
                                    </div>
                                </div>
                                <!-- Collection facets-->
                                <h3>Samling</h3>
                                <hr>
                                <div class="ui list" style="height:500px; overflow-y: scroll">
                                    <div class="ui checkbox item" ng-repeat="bucket in results['aggregations']['isPartOf.exact']['buckets']">
                                        <input id="isPartOf-{{bucket.key}}" type="checkbox" checklist-model="selectedFilters" checklist-value="getCheckedValue('isPartOf.exact', bucket.key)" ng-click="search()">
                                        <label for="isPartOf-{{bucket.key}}" ng-class="{'disabled': bucket.doc_count == 0}"> {{bucket.key}}
                                            <span ng-if="bucket.doc_count > 0" style="color:grey"> ({{bucket.doc_count | number}})</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div ng-if="ready && results.hits.total === 0" style="margin-top: 50px;" class="no-hits ui ten wide column">
                                <div class="ui text ui center aligned container">
                                    <h1 style="font-size: 4em;" class="ui icon header">
                                        Ingen treff
                                    </h1>
                                    <img class="ui rounded bordered fluid image" src='img/giphy.gif'>
                                    <h1 style="font-size: 4em;" class="ui icon header">
                                        Søket ditt var ikke <i>cool</i>!
                                    </h1>
                                    <p>Niks, vi trenger et stiligere søk for å finne noe kult! </p>
                                </div>
                            </div>

                            <div ng-show="results.hits.total > 0" class="search-hits ng-cloak ui eleven wide column">
                                <br/>
                                <div>
                                    <strong class="ui item" ng-bind-template="{{results.hits.total | number}}" style="font-size:2em;"></strong> <span style="font-size: 1.8em"> treff</span>
                                    <div class="pull-right">
                                        <label for="sort_by">Sortér på:</label>
                                        <select id="sort_by"
                                                ng-model="sortBy"
                                                ng-change="search()"
                                                ng-options="item.value as item.displayName for item in sortOptions">
                                        </select>
                                    </div>
                                </div>
                                <div class="results-hit ng-cloak">
                                    <hr>
                                    <uib-pagination class="pagination hidden-sm hidden-xs" total-items="results.hits.total"
                                                    items-per-page="pageSize"
                                                    ng-model="currentPage"
                                                    ng-change="search()"
                                                    next-text="Neste"
                                                    previous-text="Forrige"
                                                    max-size="4"
                                                    first-text="&laquo;"
                                                    last-text="&raquo;"
                                                    boundary-links="true"
                                                    force-ellipses="true">
                                    </uib-pagination>
                                    <div class="single-select form-group hidden-xs hidden-sm">
                                        <label class="ui item" for="docPerPage">Treff/side: </label>
                                        <select id="docPerPage" ng-model="pageSize" ng-change="search()">
                                            <option value="10">10</option>
                                            <option value="20">20</option>
                                            <option value="30">30</option>
                                            <option value="100">100</option>
                                            <option value="200">200</option>
                                            <option value="250">250</option>
                                        </select>
                                    </div><br>
                                    <!-- Search results view--->
                                    <div class="ui divided items">
                                        <div ng-repeat="doc in results.hits.hits track by $index" class="ui item">
                                            <div include-replace ng-if='doc._type == "document"'  ng-include="'partials/document-hits.html'" style="page-break-inside: avoid;" class="ui item fade" ></div>
                                            <div include-replace ng-if='doc._source.type == "Person" || doc._source.type == "Organisajon" || doc._source.type == "Firma" || doc._source.type == "Katalogisator"' ng-include="'partials/agent-hits.html'" style="page-break-inside: avoid;" class="ui item"></div>
                                            <div include-replace ng-if='doc._source.type == "Monument" || doc._source.type == "Objekt"' ng-include="'partials/object-hits.html'" style="page-break-inside: avoid;" class="ui item fade"></div>
                                            <div include-replace ng-if='doc._source.type == "Skip" || doc._source.type == "Emne" || doc._source.type == "Fartøy"' ng-include="'partials/vessel-hits.html'" style="page-break-inside: avoid;" class="ui item fade"></div>
                                            <div include-replace ng-if='doc._source.type == "Akkvisisjon"' ng-include="'partials/acquisition-hits.html'" style="page-break-inside: avoid;" class="ui item fade"></div>
                                            <div include-replace ng-if='doc._source.type == "Arbeidsliste"' ng-include="'partials/object-hits.html'" style="page-break-inside: avoid;" class="ui item fade"></div>
                                            <div include-replace ng-if='doc._source.type == "Aggregering"' ng-include="'partials/aggregation-hits.html'" style="page-break-inside: avoid;" class="ui item fade"></div>
                                        </div>
                                    </div>

                                    <uib-pagination class="pagination" total-items="results.hits.total"
                                                    items-per-page="pageSize"
                                                    ng-model="currentPage"
                                                    ng-change="search()"
                                                    next-text="Neste"
                                                    previous-text="Forrige"
                                                    max-size="4"
                                                    first-text="&laquo;"
                                                    last-text="&raquo;"
                                                    boundary-links="true"
                                                    force-ellipses="true">
                                    </uib-pagination>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        <script id="result-template" type="text/x-handlebars-template">
            <div class="ProfileCard u-cf">
            <div class="ProfileCard-details">
            <div class="ProfileCard-realName">{{value}}</div>
            <div class="ProfileCard-screenName"></div>
            <div class="ProfileCard-description">{{value}}</div>
            </div>
            </div>
        </script>
        <script id="empty-template" type="text/x-handlebars-template">
            <div class="EmptyMessage">Your search turned up 0 hits</div>
        </script>

        <!--JavaScript files -->
        <script src="js/lib/typeahead/js/handlebars.js"></script>
        <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
        <script src="js/lib/typeahead/js/jquery.xdomainrequest.min.js"></script>
        <script src="js/lib/typeahead/js/typeahead.bundle.js"></script>
        <script src="js/lib/typeahead/js/main.js"></script>
        <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-route.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-animate.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.1.8/semantic.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-i18n/1.5.5/angular-locale_nb-no.min.js"></script>
        <script src="js/marcus-app.js"></script>
        <script src="js/util/strings.js"></script>
        <script src="js/checklist-directive.js"></script>
        <script src="js/jquery-datepicker.js"></script>
        <script src="js/ui-bootstrap-1.1.2.min.js"></script>

        <!--These are constants for this particular page-->
        <script>
            angular.module("settings", [])
                .constant("mySetting", {
                    index: ["admin-test"],
                        /**type: ["document"],**/
                        facets: [
                        {"field": "type.exact", "size": 40, "operator": "OR", "order": "term_asc", "min_doc_count" : 0},
                        {"field": "hasZoom", "size": 10, "operator": "AND", "order": "term_asc", "min_doc_count" : 0},
                        {"field": "isDigitized", "size": 10, "operator": "AND", "order": "count_desc", "min_doc_count" : 0},
                        {"field": "isCatalogued", "size": 10, "operator": "AND", "order": "count_desc", "min_doc_count" : 0},
                        {"field": "subject.exact", "size" : 30, "operator": "AND", "min_doc_count" : 1},
                        {"field": "isPartOf.exact", "size": 20, "operator": "OR", "order" : "count_desc", "min_doc_count" : 1}
                        /*Supported intervals: weeks(w), days(d), hours(h), minutes(m), seconds(s)*/
                        //{"field": "created", "type" : "date_histogram", "format" : "yyyy", "interval" : "520w", "min_doc_count" : 1, "order" : "key_asc"}
                        ]
            });
                $('.ui.dropdown').dropdown({
                    allowAdditions: true });
        </script>
    </body>
</html>
